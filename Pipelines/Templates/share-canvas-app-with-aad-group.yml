parameters:
- name: serviceConnection
  type: string
- name: aadGroupCanvasConfiguration
  type: string  

steps:
- powershell: |
    . "$env:POWERSHELLPATH/canvas-unpack-pack.ps1"
     Share-Canvas-App-with-AAD-Group "$(CoETools_Microsoft_PowerApps_Administration_PowerShell)" "$(PowerAppsAdminModuleVersion)" "$(TenantId)" "$(buildConnectionVariables.BuildTools.ApplicationId)" "$(buildConnectionVariables.BuildTools.ClientSecret)" "$(CoeTools_Microsoft_Xrm_Data_Powershell)" "$(XrmDataPowerShellVersion)" "${{parameters.serviceConnection}}" "${{parameters.aadGroupCanvasConfiguration}}" "$(BuildTools.EnvironmentId)"
  displayName: 'Share Canvas App with AAD Group'
  condition: and(succeeded(), not(contains('${{parameters.aadGroupCanvasConfiguration}}', '$(')))
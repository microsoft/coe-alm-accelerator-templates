parameters:
- name: solutionName
  type: string
- name: solutionDisplayName
  type: string
- name: connectionName
  type: string
- name: releaseNotesPath
  type: string

steps:  
# Get the solution package from artifact uploaded by the build pipeline
#- task: DownloadPipelineArtifact@2
#  displayName: 'Download Build Pipeline Artifact'

- powershell: 
    Get-ChildItem -Path '$(Pipeline.Workspace)' -recurse
  displayName: 'Showing the folder tree'

- powershell: |
    $today = (Get-Date)
    $monthName = $today.ToString("MMMM")
    $yearName = $today.ToString("yyyy")
    Write-Host "##vso[task.setVariable variable=MonthName]$monthName"
    Write-Host "##vso[task.setVariable variable=YearName]$yearName"
  displayName: 'Get Current Month and Year for Release Name'

- task: GitHubRelease@1
  inputs:
    gitHubConnection: ${{ parameters.connectionName }}
    tagSource: 'userSpecifiedTag'
    tag: '${{ parameters.solutionName }}-$(MonthName)$(YearName)'
    title: '${{ parameters.solutionDisplayName }} $(MonthName) $(YearName)'
    releaseNotesFilePath: '${{ parameters.releaseNotesPath }}'
    changeLogType: issueBased
    isDraft: true
    isPreRelease: true
    assets: |
      $(Pipeline.Workspace)/drop/*.*
  displayName: 'Create ${{ parameters.solutionDisplayName }} Release'
